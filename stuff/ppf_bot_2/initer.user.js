// ==UserScript==
// @name         PPF dark bot
// @version      2.7
// @author       Darkness
// @description  Have fun
// @icon         https://raw.githubusercontent.com/TouchedByDarkness/PixelPlanet-Bot/master/rounded-avatar-128.png
// @grant        GM_xmlhttpRequest
// @grant        GM_openInTab
// @grant        unsafeWindow
// @downloadURL  https://touchedbydarkness.github.io/stuff/ppf_bot_2/initer.user.js
// @updateURL  	https://touchedbydarkness.github.io/stuff/ppf_bot_2/initer.user.js
// @connect		 	black-and-red.space
// @connect		 	fuckyouarkeros.fun
// @connect		 	pixelplanet.fun
// @connect		 	localhost
// @connect		 	githubusercontent.com
// @connect		 	github.com
// @connect		 	voidserv.glitch.me
// @connect		 	fuckyouarkeros.fun
// @connect		 	pixelplanet.fun
// @connect		 	localhost
// @match      	*://fuckyouarkeros.fun/*
// @match      	*://pixelplanet.fun/*
// @match      	*://localhost/*
// ==/UserScript==

function parseVersion(versionString){return versionString.split(".").map(Number)}

function isVersionGreater(version2,version1){const v1=parseVersion(version1);const v2=parseVersion(version2);const maxLength=Math.max(v1.length,v2.length);for(let i=0;i<maxLength;i++){const num1=v1[i]||0;const num2=v2[i]||0;if(num1<num2)return true;if(num1>num2)return false}return false}

fetch(GM_info.script.updateURL)
.then(res => res.text())
.then(code => {
const lines = code.replaceAll('\r', '').split('\n');
const versionLine = lines.find(line => line.includes('@version'));
const version = versionLine.match(/(\d|\.)+/g)?.pop();
if(!version || !isVersionGreater(version, GM_info.script.version)) {
function payload(){"undefined"==typeof unsafeWindow&&(globalThis.unsafeWindow=globalThis.window),(()=>{function t(t,e,r){let n=new ArrayBuffer(3+4*r.length),i=new DataView(n);i.setUint8(0,145),i.setUint8(1,t),i.setUint8(2,e);let s=2,o=r.length;for(;o;){o-=1;let[t,e]=r[o];i.setUint8(s+=1,t>>>16),i.setUint16(s+=1,65535&t),i.setUint8(s+=2,e)}return n}function e(t,e){let r={};return e.forEach((e=>{let n=t.get(e[0],e[1]),i=r[n];i||(i=[],r[n]=i),i.push(e)})),r}function r(t){let e=0,r=0;return t.forEach((t=>{e+=t[0],r+=t[1]})),[Math.trunc(e/t.length),Math.trunc(r/t.length)]}function n(t){if(t.length<=5)return z(t);let e=new Map;for(let r=1;r!==t.length;r++)e.set(s(t[r]),r);for(let r=0;r!==t.length-1;r++){let n,a,l=t[r],h=1/0,c=-1;if(1===e.size)n=o(e.keys().next().value);else for(;!n;)c++,i(l,c,((t,r)=>{let i=[t,r],o=e.get(s(i));if(void 0!==o){let t=st(l,i);(t<h||t==h&&o<a)&&(h=t,n=i,a=o)}}));e.delete(s(n)),t[r+1]=n}return t}function i(t,e,r){let n=0,i=e,s=3-(i<<1),[o,a]=t;for(;n<=i;)r(o+n,a+i),r(o+n,a-i),r(o-n,a+i),r(o-n,a-i),r(o+i,a+n),r(o+i,a-n),r(o-i,a+n),r(o-i,a-n),s<0?s+=6+(n<<2):(s+=10+(n-i<<2),i--),n++}function s(t){return t[0]|t[1]<<16}function o(t){return[255&t,t>>16]}function a(){WebSocket.prototype.send=()=>{}}async function l(){let t=await Fe.get();if(t)switch(t.status){case 2:t.stop();break;case 0:d(t.start())}}function h(...t){console.debug("[DB]",...t.map((t=>"object"==typeof t&&t.hasOwnProperty("toString")?t.toString():t)))}async function c(){if(await ze.clear(),Fe.ready){let t=await ze.get(),e=Fe.now();if(!e||!t){let r=[];return e||r.push("bot"),t||r.push("targeter"),void h("cant change targeter because "+r.join(" and ")+" is missing")}await u(),e.changeTargeter(t)}else await u()}async function u(){let[t,e]=await Promise.all([Re.get(),Ne.get()]);if(!t||!e){let r=[];return t||r.push("api"),e||r.push("template"),void h("cant change workspace because "+r.join(" and ")+" is missing")}let r=!1,n=Fe.now();n&&0!==n.status&&(r=!0,await n.stop());let i=t.createWorkspace(...e.toArray());t.hasWorkspace(i)||await t.changeWorkspace(i),r&&(n=Fe.now(),n&&d(n.start()))}function d(t){return We.setBotStatus("works"),t.then((t=>{t?(h("error returned",t),lt.emit(8,t)):We.setBotStatus("idle")}))}var p,f,g,m,y,w,v,b,x,C,P,k,S,E,T,M,O,A,I,_,j,L,D,W,F,z,N,R,U,$,B,H,V,q,G,Y,Z,Q,K,X,J,tt,et,rt,nt,it,st,ot,at,lt,ht,ct,ut,dt,pt,ft,gt,mt,yt,wt,vt,bt,xt,Ct,Pt,kt,St,Et,Tt,Mt,Ot,At,It,_t,jt,Lt,Dt,Wt,Ft,zt,Nt,Rt,Ut,$t,Bt,Ht,Vt,qt,Gt,Yt,Zt,Qt,Kt,Xt,Jt,te,ee,re,ne,ie,se,oe,ae,le,he,ce,ue,de,pe,fe,ge,me,ye,we,ve,be,xe,Ce,Pe,ke,Se,Ee,Te,Me,Oe,Ae,Ie,_e,je,Le,De,We,Fe,ze,Ne,Re,Ue,$e=Object.create,Be=Object.defineProperty,He=Object.getOwnPropertyDescriptor,Ve=Object.getOwnPropertyNames,qe=Object.getPrototypeOf,Ge=Object.prototype.hasOwnProperty,Ye=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ze=(t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of Ve(e))!Ge.call(t,i)&&i!==r&&Be(t,i,{get:()=>e[i],enumerable:!(n=He(e,i))||n.enumerable});return t},Qe=(t,e,r)=>(r=null!=t?$e(qe(t)):{},Ze(!e&&t&&t.__esModule?r:Be(r,"default",{value:t,enumerable:!0}),t)),Ke=Ye(((t,e)=>{"use strict";function r(){r.init.call(this)}function n(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function i(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function s(t,e,r,s){var o,a,l,h;return n(r),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),a=t._events),l=a[e]),void 0===l?(l=a[e]=r,++t._eventsCount):("function"==typeof l?l=a[e]=s?[r,l]:[l,r]:s?l.unshift(r):l.push(r),(o=i(t))>0&&l.length>o&&!l.warned&&(l.warned=!0,(h=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=l.length,function(t){console&&console.warn&&console.warn(t)}(h))),t}function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function a(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=o.bind(n);return i.listener=r,n.wrapFn=i,i}function l(t,e,r){var n,i=t._events;return void 0===i||void 0===(n=i[e])?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(n):c(n,n.length)}function h(t){var e,r=this._events;if(void 0!==r){if("function"==typeof(e=r[t]))return 1;if(void 0!==e)return e.length}return 0}function c(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function u(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){n.once&&t.removeEventListener(e,i),r(s)}))}}var d,p,f,g="object"==typeof Reflect?Reflect:null,m=g&&"function"==typeof g.apply?g.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};d=g&&"function"==typeof g.ownKeys?g.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)},p=Number.isNaN||function(t){return t!=t},e.exports=r,e.exports.once=function(t,e){return new Promise((function(r,n){function i(r){t.removeListener(e,s),n(r)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}u(t,e,s,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&u(t,"error",e,r)}(t,i,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0,f=10,Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(t){if("number"!=typeof t||t<0||p(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");f=t}}),r.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||p(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return i(this)},r.prototype.emit=function(t){var e,r,n,i,s,o,a,l,h;for(e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);if(n="error"===t,void 0!==(i=this._events))n=n&&void 0===i.error;else if(!n)return!1;if(n){if(e.length>0&&(s=e[0]),s instanceof Error)throw s;throw(o=new Error("Unhandled error."+(s?" ("+s.message+")":""))).context=s,o}if(void 0===(a=i[t]))return!1;if("function"==typeof a)m(a,this,e);else for(h=c(a,l=a.length),r=0;r<l;++r)m(h[r],this,e);return!0},r.prototype.addListener=function(t,e){return s(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return s(this,t,e,!0)},r.prototype.once=function(t,e){return n(e),this.on(t,a(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){return n(e),this.prependListener(t,a(this,t,e)),this},r.prototype.removeListener=function(t,e){var r,i,s,o,a;if(n(e),void 0===(i=this._events))return this;if(void 0===(r=i[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){a=r[o].listener,s=o;break}if(s<0)return this;0===s?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,s),1===r.length&&(i[t]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",t,a||e)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(t){var e,r,n,i,s;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){for(i=Object.keys(r),n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},r.prototype.listeners=function(t){return l(this,t,!0)},r.prototype.rawListeners=function(t){return l(this,t,!1)},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):h.call(t,e)},r.prototype.listenerCount=h,r.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]}})),Xe=Ye(((t,e)=>{"use strict";var r,n;r=t,n=function(){var t="function"==typeof Promise,e=function(t){if("object"==typeof globalThis)return globalThis;Object.defineProperty(t,"typeDetectGlobalObject",{get:function(){return this},configurable:!0});var e=typeDetectGlobalObject;return delete t.typeDetectGlobalObject,e}(Object.prototype),r=typeof Symbol<"u",n=typeof Map<"u",i=typeof Set<"u",s=typeof WeakMap<"u",o=typeof WeakSet<"u",a=typeof DataView<"u",l=r&&typeof Symbol.iterator<"u",h=r&&typeof Symbol.toStringTag<"u",c=i&&"function"==typeof Set.prototype.entries,u=n&&"function"==typeof Map.prototype.entries,d=c&&Object.getPrototypeOf((new Set).entries()),p=u&&Object.getPrototypeOf((new Map).entries()),f=l&&"function"==typeof Array.prototype[Symbol.iterator],g=f&&Object.getPrototypeOf([][Symbol.iterator]()),m=l&&"function"==typeof String.prototype[Symbol.iterator],y=m&&Object.getPrototypeOf(""[Symbol.iterator]());return function(r){var l,c,u=typeof r;if("object"!==u)return u;if(null===r)return"null";if(r===e)return"global";if(Array.isArray(r)&&(!1===h||!(Symbol.toStringTag in r)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&r===window.location)return"Location";if("object"==typeof window.document&&r===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&r===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&r===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&r instanceof window.HTMLElement){if("BLOCKQUOTE"===r.tagName)return"HTMLQuoteElement";if("TD"===r.tagName)return"HTMLTableDataCellElement";if("TH"===r.tagName)return"HTMLTableHeaderCellElement"}}return"string"==typeof(l=h&&r[Symbol.toStringTag])?l:(c=Object.getPrototypeOf(r))===RegExp.prototype?"RegExp":c===Date.prototype?"Date":t&&c===Promise.prototype?"Promise":i&&c===Set.prototype?"Set":n&&c===Map.prototype?"Map":o&&c===WeakSet.prototype?"WeakSet":s&&c===WeakMap.prototype?"WeakMap":a&&c===DataView.prototype?"DataView":n&&c===p?"Map Iterator":i&&c===d?"Set Iterator":f&&c===g?"Array Iterator":m&&c===y?"String Iterator":null===c?"Object":Object.prototype.toString.call(r).slice(8,-1)}},"object"==typeof t&&typeof e<"u"?e.exports=n():"function"==typeof define&&define.amd?define(n):(r=typeof globalThis<"u"?globalThis:r||self).typeDetect=n()})),Je=Ye(((t,e)=>{"use strict";function r(){this._key="chai/deep-eql__"+Math.random()+Date.now()}function n(t,e,r){var n,i;return!r||g(t)||g(e)?null:(n=r.get(t))&&"boolean"==typeof(i=n.get(e))?i:null}function i(t,e,r,n){if(r&&!g(t)&&!g(e)){var i=r.get(t);i?i.set(e,n):((i=new y).set(e,n),r.set(t,i))}}function s(t,e,r){if(r&&r.comparator)return a(t,e,r);var n=o(t,e);return null!==n?n:a(t,e,r)}function o(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e||!g(t)&&!g(e)&&null}function a(t,e,r){var a,g,v,b,x,C,P;if((r=r||{}).memoize=!1!==r.memoize&&(r.memoize||new y),a=r&&r.comparator,null!==(g=n(t,e,r.memoize)))return g;if(null!==(v=n(e,t,r.memoize)))return v;if(a){if(!1===(b=a(t,e))||!0===b)return i(t,e,r.memoize,b),b;if(null!==(x=o(t,e)))return x}return(C=w(t))!==w(e)?(i(t,e,r.memoize,!1),!1):(i(t,e,r.memoize,!0),P=function(t,e,r,n){switch(r){case"String":case"Number":case"Boolean":case"Date":return s(t.valueOf(),e.valueOf());case"Promise":case"Symbol":case"function":case"WeakMap":case"WeakSet":return t===e;case"Error":return f(t,e,["name","message","code"],n);case"Arguments":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"Array":return h(t,e,n);case"RegExp":return function(t,e){return t.toString()===e.toString()}(t,e);case"Generator":return function(t,e,r){return h(u(t),u(e),r)}(t,e,n);case"DataView":return h(new Uint8Array(t.buffer),new Uint8Array(e.buffer),n);case"ArrayBuffer":return h(new Uint8Array(t),new Uint8Array(e),n);case"Set":case"Map":return l(t,e,n);case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.Instant":case"Temporal.ZonedDateTime":case"Temporal.PlainYearMonth":case"Temporal.PlainMonthDay":return t.equals(e);case"Temporal.Duration":return t.total("nanoseconds")===e.total("nanoseconds");case"Temporal.TimeZone":case"Temporal.Calendar":return t.toString()===e.toString();default:return function(t,e,r){var n,i,s=d(t),o=d(e),a=p(t),l=p(e);if(s=s.concat(a),o=o.concat(l),s.length&&s.length===o.length)return!1!==h(m(s).sort(),m(o).sort())&&f(t,e,s,r);n=c(t),i=c(e);return n.length&&n.length===i.length?(n.sort(),i.sort(),h(n,i,r)):0===s.length&&0===n.length&&0===o.length&&0===i.length}(t,e,n)}}(t,e,C,r),i(t,e,r.memoize,P),P)}function l(t,e,r){try{if(t.size!==e.size)return!1;if(0===t.size)return!0}catch{return!1}var n=[],i=[];return t.forEach((function(t,e){n.push([t,e])})),e.forEach((function(t,e){i.push([t,e])})),h(n.sort(),i.sort(),r)}function h(t,e,r){var n,i=t.length;if(i!==e.length)return!1;if(0===i)return!0;for(n=-1;++n<i;)if(!1===s(t[n],e[n],r))return!1;return!0}function c(t){if(function(t){return typeof Symbol<"u"&&"object"==typeof t&&typeof Symbol.iterator<"u"&&"function"==typeof t[Symbol.iterator]}(t))try{return u(t[Symbol.iterator]())}catch{return[]}return[]}function u(t){for(var e=t.next(),r=[e.value];!1===e.done;)e=t.next(),r.push(e.value);return r}function d(t){var e,r=[];for(e in t)r.push(e);return r}function p(t){var e,r,n,i;for(e=[],r=Object.getOwnPropertySymbols(t),n=0;n<r.length;n+=1)i=r[n],Object.getOwnPropertyDescriptor(t,i).enumerable&&e.push(i);return e}function f(t,e,r,n){var i,o=r.length;if(0===o)return!0;for(i=0;i<o;i+=1)if(!1===s(t[r[i]],e[r[i]],n))return!1;return!0}function g(t){return null===t||"object"!=typeof t}function m(t){return t.map((function(t){return"symbol"==typeof t?t.toString():t}))}var y,w=Xe();r.prototype={get:function(t){return t[this._key]},set:function(t,e){Object.isExtensible(t)&&Object.defineProperty(t,this._key,{value:e,configurable:!0})}},y="function"==typeof WeakMap?WeakMap:r,e.exports=s,e.exports.MemoizeMap=y})),tr=Ye((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asArraysFactory=void 0,t.asArraysFactory=function(t){return()=>t.map((t=>t.items))}})),er=Ye((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asEntriesFactory=void 0,t.asEntriesFactory=function(t){return e=>{var r,n;let i=null!==(r=e?.keyName)&&void 0!==r?r:"key",s=null!==(n=e?.itemsName)&&void 0!==n?n:"items";return t.map((t=>({[i]:t.key,[s]:t.items})))}}})),rr=Ye((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asMapFactory=void 0,t.asMapFactory=function(t){return()=>{let e=new Map;for(let r of t)e.set(r.key,r.items);return e}}})),nr=Ye((t=>{"use strict";function e(t){return"string"==typeof t||"number"==typeof t||"symbol"==typeof t}Object.defineProperty(t,"__esModule",{value:!0}),t.asObjectFactory=void 0,t.asObjectFactory=function(t){return()=>{let r={};for(let n of t)e(n.key)&&(r[n.key]=n.items);return r}}})),ir=Ye((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asTuplesFactory=void 0,t.asTuplesFactory=function(t){return()=>t.map((t=>[t.key,t.items]))}})),sr=Ye((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keysFactory=void 0,t.keysFactory=function(t){return()=>t.map((t=>t.key))}})),or=Ye((t=>{"use strict";var e,r,n,i,s,o,a,l=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.group=void 0,e=l(Je()),r=tr(),n=er(),i=rr(),s=nr(),o=ir(),a=sr(),t.group=function(t){return Object.freeze({by:l=>{let h=function(t,r){let n=[],i=new Map,s=0;for(let o of t){let t=r(o,s);s++;let a="object"==typeof t?JSON.stringify(t):t,l=i.get(a);null==l&&(l=[],i.set(a,l));let h=!1;for(let r of l)if((0,e.default)(r.key,t)){r.items.push(o),h=!0;break}if(!h){let e={key:t,items:[o]};n.push(e),l.push(e)}}return n}(t,"function"==typeof l?l:t=>t[l]);return Object.freeze({asArrays:(0,r.asArraysFactory)(h),asEntries:(0,n.asEntriesFactory)(h),asMap:(0,i.asMapFactory)(h),asObject:(0,s.asObjectFactory)(h),asTuples:(0,o.asTuplesFactory)(h),keys:(0,a.keysFactory)(h)})}})}})),ar=Ye((t=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.group=void 0;var e=or();Object.defineProperty(t,"group",{enumerable:!0,get:function(){return e.group}})})),lr=class{constructor(t,e){this.offset=t,this.colors=e,this.monochromes=this.colors.map((t=>t.reduce(((t,e)=>t+e))/3)),this.ids=Object.fromEntries(this.colors.map(((t,e)=>[t.toString(),e]))),this.singleColorIds=Object.fromEntries(this.colors.map(((t,e)=>[e,this.colors.findIndex(((r,n)=>e!==n&&t.every(((t,e)=>t===r[e]))))])).filter((([,t])=>-1!==t)))}monochrome(t){return this.monochromes[t]}sameIds(t,e){return t===e||this.singleColorIds[t]===e}same(t,e,r=15){return Math.abs(t[0]-e[0])<r&&Math.abs(t[1]-e[1])<r&&Math.abs(t[2]-e[2])<r}strictSame(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}has(t){return void 0!==this.rgbToId(t)}idToRGB(t){return this.colors[t]}convert(t,e,r){let n=0,i=1/0;for(let s=this.offset;s!==this.colors.length;s++){let o=this.colors[s],a=j(o[0]-t)+j(o[1]-e)+j(o[2]-r);if(0===a)return s;a<i&&(i=a,n=s)}return n}rgbToId(t){return this.ids[t.toString()]||null}},hr=Qe(Ke()),cr=new Error("no connection"),ur=new Error("need template source"),dr=(new Error("no access to canvas api"),new Error("need template position")),pr=new Error("canvas undefined"),fr=new Error("strategy undefined"),gr=new Error("promise deadline"),mr=new Error("errAborterTriggered"),yr=new Error("default strategy doesnt exists"),wr=new Error("errSeveralNoPlacePixelResult"),vr=new Error("Max attempts reached"),br=class extends hr.default{wait(t,e=5e3){return new Promise(((r,n)=>{let i=setTimeout((()=>n(gr)),e);this.once(t,(t=>{clearTimeout(i),r(t)}))}))}},xr=class extends br{on(t,e){return super.on(t,e)}once(t,e){return super.once(t,e)}wait(t,e){return super.wait(t,e)}off(t,e){return super.off(t,e)}emit(t,e){return void 0!==e?super.emit(t,e):super.emit(t)}},Cr=class extends xr{constructor(t,e){super(),this.ws=null,this.url=t,e&&e.reconnectDelay&&this.on(1,(t=>{t.wasClean||setTimeout((()=>this.connect()),e.reconnectDelay)}))}get connected(){return null!==this.ws&&this.ws.readyState===WebSocket.OPEN}get disconnected(){return!this.connected}get connecting(){return this.ws&&this.ws.readyState===WebSocket.CONNECTING}connect(){return new Promise(((t,e)=>{(this.ws?.readyState===WebSocket.CONNECTING||this.ws?.readyState===WebSocket.OPEN)&&e(new Error("try connect when websocket is OPEN or CONNECTING"));let r=!1;this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{this.emit(0),r=!0,t()},this.ws.onclose=t=>{this.emit(1,t),r||e(t)},this.ws.onerror=t=>{this.emit(2,t)},this.ws.onmessage=({data:t})=>{"string"==typeof t?this.emit(3,t):this.emit(4,t)}}))}async disconnect(){this.ws&&(this.ws.close(),await this.wait(1),this.ws=null)}send(t){if(null===this.ws||this.disconnected)throw cr;this.ws.send(t)}},Pr=class t{constructor(t,e,r,n){this.x1=t,this.y1=e,this.x2=r,this.y2=n}get width(){return this.x2-this.x1}set width(t){this.x2=this.x1+t}get height(){return this.y2-this.y1}set height(t){this.y2=this.y1+t}get localCenter(){return[this.width/2,this.height/2]}get center(){return[(this.x1+this.x2)/2,(this.y1+this.y2)/2]}in(t,e){return this.x1<=t&&t<this.x2&&this.y1<=e&&e<this.y2}toArray(){return[this.x1,this.y1,this.x2,this.y2]}moveY(t){this.move(this.x1,t)}moveX(t){this.move(t,this.y1)}move(t,e){let r=this.width,n=this.height;this.x1=t,this.y1=e,this.width=r,this.height=n}copy(){return new t(this.x1,this.y1,this.x2,this.y2)}},kr=class{constructor(t=6e4){this.triggered=!1,this.resolve=()=>{},this.timeout=setTimeout((()=>this.destroy()),t),this.promise=new Promise((t=>this.resolve=t))}abort(){this.resolve(mr),clearTimeout(this.timeout),this.triggered=!0}destroy(){this.resolve(),clearTimeout(this.timeout)}},Sr=class{constructor(t,e){this.build=t,this.onerror=e}#t=null;#e=null;get ready(){return null!==this.#t&&!(this.#t instanceof Promise)}async clear(){let t;return this.#t instanceof Promise&&(t=this.#t.then((t=>{if(t&&"destroy"in t)return t.destroy()})).then((()=>{})),this.#t=null,this.#e?.abort(),this.#e=null),null!==this.#t&&(this.#t=null),t||Promise.resolve()}get(){return null===this.#t?(this.#e=new kr,this.#t=Promise.any([this.build().then((t=>this.#t=t)).catch((t=>(this.onerror?.(t),null))),this.#e.promise.then((()=>null))]),this.#t):this.#t instanceof Promise?this.#t:Promise.resolve(this.#t)}getExists(){return Promise.resolve(this.#t)}now(){return null===this.#t||this.#t instanceof Promise?null:this.#t}},Er="https://voidserv.glitch.me",Tr="https://boosty.to/touchedbydarkness",Mr="https://discord.gg/VyfVmD2nhZ",Or="https://github.com/TouchedByDarkness",Ar=["From Void with love","Made in Void","From Void to all"],Ir="darkness_bot",_r=class{constructor(){this.dict=new Map}get(t,e){return this.dict.get(this.coordsToIndex(t,e))}delete(t,e){return this.dict.delete(this.coordsToIndex(t,e))}has(t,e){return this.dict.has(this.coordsToIndex(t,e))}set(t,e,r){this.dict.set(this.coordsToIndex(e,r),t)}clear(){this.dict.clear()}coordsToIndex(t,e){return e+"_"+t}},jr=class{constructor(t){this.data=t}get length(){return this.data.length}get(t){return this.data[t]}set(t,e){this.data[t]=e}},Lr=class{constructor(){this.updatedAt=0,this.cooldown=0}update(t){this.cooldown=t,this.updatedAt=Date.now()}get(){return Math.max(0,this.cooldown-(Date.now()-this.updatedAt))}},Dr=class{constructor(){this.timer=new Lr}get chunkSize(){return this.info.chunkWidth*this.info.chunkHeight}getChunksCoords(t,e,r,n){t=Math.floor((t+this.info.worldWidth/2)/this.info.chunkWidth),e=Math.floor((e+this.info.worldHeight/2)/this.info.chunkHeight),r=Math.floor((r-1+this.info.worldWidth/2)/this.info.chunkWidth),n=Math.floor((n-1+this.info.worldHeight/2)/this.info.chunkHeight);let i=[];for(let s=t;s<=r;s++)for(let t=e;t<=n;t++)i.push([s,t]);return i}toTiled(t,e){return t+=this.info.worldWidth>>1,e+=this.info.worldHeight>>1,[Math.floor(t/this.info.chunkWidth),Math.floor(e/this.info.chunkHeight),e%this.info.chunkHeight*this.info.chunkWidth+t%this.info.chunkWidth]}toWorld(t,e,r){return[t*this.info.chunkWidth-(this.info.worldWidth>>1)+r%this.info.chunkWidth,e*this.info.chunkHeight-(this.info.worldHeight>>1)+Math.floor(r/this.info.chunkWidth)]}},Wr=(t,e)=>t[0]===e[0]&&t[1]===e[1],Fr=(t,e)=>t.some((t=>Wr(t,e))),zr=class{constructor(t){this.low=t,this.workspaces=[],this.chunks=[];let{offset:e,colors:r}=this.info.palette;this.palette=new lr(e,r)}get info(){return this.low.info}on(t,e){return this.low.emitter.on(t,e)}emit(t,e){return this.low.emitter.emit(t,e)}wait(t){return this.low.emitter.wait(t)}getCaptcha(){return this.low.getCaptcha()}sendAnswer(t){return this.low.sendAnswer(t)}getCooldown(){return this.low.timer.get()}pixelsCanPlace(){let t=Math.max(this.info.minCd,this.info.maxCd);return Math.floor((this.info.stack-this.getCooldown())/t)}get(t,e){return this.low.get(t,e)}compare(t){let e=this.get(t.x,t.y);return this.palette.sameIds(e,t.id)}predictCooldown(t,e){return this.low.predictCooldown(t,e)}createWorkspace(t,e,r,n){return{x1:t,y1:e,x2:r,y2:n,chunks:this.low.getChunksCoords(t,e,r,n)}}hasWorkspace(t){return this.workspaces.some((e=>e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2))}async changeWorkspace(t){this.clearWorkspaces(),await this.addWorkspace(t)}async addWorkspace(t){let e=t.chunks.filter((t=>!Fr(this.chunks,t)));await this.low.prepareChunks(e),this.chunks.push(...e),this.workspaces.push(t)}clearWorkspaces(){this.chunks.length&&this.low.dropChunks(this.chunks),this.chunks=[]}placePixels(t){return this.low.placePixels(t)}async smartPlace(t,e){t=t.slice();let r=new Promise((async r=>{for(;;){if(e?.triggered)return;let n=t.shift();if(!n)break;let i=await this.low.placePixels([n]);if(i)return t.unshift(n),void r([t,i]);t.length&&await this.waitBecausePixelsDistance(n,t[0])}r([t,null])}));if(e){let n=await Promise.any([r,e.promise]);return n instanceof Error?(e.destroy(),[t,n]):n}return r}async download(t,e,r,n){await this.low.prepareChunks(this.low.getChunksCoords(t,e,r,n));let i=r-t,s=n-e,o=document.createElement("canvas").getContext("2d");o.canvas.width=i,o.canvas.height=s;let a=o.getImageData(0,0,i,s),l=a.data;for(let i=e,s=0;i!==n;i++)for(let e=t;e!==r;e++,s+=4){let t=this.palette.idToRGB(this.get(e,i));void 0!==t?(l[0|s]=t[0],l[1|s]=t[1],l[2|s]=t[2],l[3|s]=255):console.log("wrong id",this.get(e,i),"at",e,i)}o.putImageData(a,0,0),Q(o.canvas,`${this.info.name}_${t}_${e}_${r}_${n}`)}destroy(){return this.low.destroy()}waitBecausePixelsDistance(t,e){let r,n=Math.sqrt(j(t.x-e.x)+j(t.y-e.y));return r=1===n?50:n<1.5?100:125*n,L(Math.min(.75*this.info.minCd,r))}},Nr={id:-1,name:"",palette:{offset:0,colors:[]},chunkWidth:0,chunkHeight:0,worldWidth:0,worldHeight:0,haveStack:!1,stack:0,minCd:0,maxCd:0,borders:new Pr(0,0,0,0)},Rr=Qe(ar()),Ur=0,$r=1,Br=2,Hr=3,Vr=4,qr=5,Gr=6,Yr=7,Zr=8,Qr=9,Kr=10,Xr=11,Jr=12,tn=13,en={errNoPlacePixelResult:new Error("errNoPlacePixelResult"),errMustAuth:new Error("errMustAuth"),errTooLowScore:new Error("errTooLowScore"),errPixelProtected:new Error("errPixelProtected"),errFullStack:new Error("errFullStack"),errCaptcha:new Error("errCaptcha"),errYouAreProxy:new Error("errYouAreProxy"),errCanvasAPIInteraction:new Error("errCanvasAPIInteraction"),errUnknownError:new Error("errUnknownError"),errAPIIsntReady:new Error("errAPIIsntReady"),errResponseIsntOk:new Error('response isnt "ok"'),errResponseStatusIsnt200:new Error("response status isnt 200"),errParallelPlace:new Error("errParallelPlace")},rn={errCaptchaTimeout:new Error("You took too long, try again."),errInvalidSolution:new Error("No or invalid captcha text")},nn=((Ue=nn||{})[Ue.PPF_EARTH=0]="PPF_EARTH",Ue[Ue.PPF_MINI=1]="PPF_MINI",Ue[Ue.PPF_MOON=2]="PPF_MOON",Ue[Ue.PPF_CORONA=3]="PPF_CORONA",Ue[Ue.PPF_PZ=4]="PPF_PZ",Ue[Ue.PPF_PC=5]="PPF_PC",Ue[Ue.PPF_BIT=6]="PPF_BIT",Ue[Ue.PPF_TOP=7]="PPF_TOP",Ue),sn={0:"PPF Earth",1:"PPF Minimap",2:"PPF Moon",3:"PPF Corona",4:"PPF PZ mirror",5:"PPF PixelCanvas",6:"PPF Bit",7:"PPF Top10"},on=(()=>{if(!unsafeWindow?.ssv?.shard||"fuckyouarkeros.fun"===unsafeWindow.location.host)return"";let t=window.location.host.split(".");return t.length>2&&t.shift(),`${unsafeWindow.ssv.shard}.${t.join(".")}`})(),an=on&&`${unsafeWindow.location.protocol}//${on}`,ln={0:0,1:2,3:3,5:4,6:5,7:6,8:7,11:1},hn=t=>t[0]<<8|t[1],cn=t=>[t>>8,255&t],un=class e extends Dr{constructor(t){super(),this.canvasId=t,this._info=Nr,this.loadQueue=[],this.pixelsDelay=150+50*Math.random(),this.delayedPixels=[],this.chunks=new _r,this.maxLoaders=2,this.loaders=[],this.chunksProcessing=!1,this.emitter=new xr,this.local=new xr,this.timer=new Lr,this.ws=new Cr(`${"https:"===window.location.protocol?"wss:":"ws:"}//${on||window.location.host}/ws`),this.ws.on(0,(async()=>{for(this.emitter.emit(0),this.selectCanvas(this.canvasId),this.emitter.emit(2);this.ws.connected;)await L(19e3),this.ws.send(new Uint8Array([176]).buffer)})),this.ws.on(4,(t=>{let e=new DataView(t);switch(e.getUint8(0)){case 145:this.handleArrivedPixel(function(t){let e=t.getUint8(1),r=t.getUint8(2),n=[],i=t.byteLength;for(;i>3;){let e=t.getUint8(i-=1),r=t.getUint16(i-=2),s=t.getUint8(i-=1)<<16;n.push([s|r,e])}return{i:e,j:r,pixels:n}}(e));break;case 195:let{retCode:t,wait:r}=function(t){return{retCode:t.getUint8(1),wait:t.getUint32(2),coolDownSeconds:t.getInt16(6),pxlCnt:t.getUint8(8),rankedPxlCnt:t.getUint8(9)}}(e);this.timer.update(r),this.local.emit(0,t);break;case 198:this.local.emit(1,function(t){return t.getUint8(1)}(e));break;case 194:this.timer.update(function(t){return t.getUint32(1)}(e))}})),this.ws.on(1,(()=>this.emitter.emit(1)))}get info(){if(this._info===Nr)throw en.errAPIIsntReady;return this._info}static async build(t){let r=new e(t);return await r.fetchMe(),await r.ws.connect(),r}get(t,e){for(let r of this.delayedPixels){let n=r.find((r=>r.x===t&&r.y===e));if(n)return n.id}return this.getHumanlike(t,e)}getHumanlike(t,e){let r=this.toTiled(t,e);return this.chunks.get(r[0],r[1]).get(r[2])}dropChunks(t){let e=[];for(let r of t){let t=hn(r);if(this.chunks.has(r[0],r[1])){e.push(r),this.chunks.delete(r[0],r[1]);continue}if(this.loadQueue.includes(t)){this.loadQueue=this.loadQueue.filter((e=>e!==t));continue}let n=this.loaders.filter((e=>e.chunk===t));n.length&&(n.forEach((t=>t.aborter.abort())),this.loaders=this.loaders.filter((e=>e.chunk!==t)))}e.length&&this.deRegisterChunks(e)}async prepareChunks(t){this.ws.disconnected&&await this.emitter.wait(2),t.forEach((t=>this.loadQueue.push(hn(t)))),this.processMarked(),await this.waitChunks(t)}async placePixels(e){let r=this.groupPixels(e),n=null;for(let e in r){let i=r[e],s=cn(+e);if(this.emitter.emit(4,i.map((({offset:t,id:e})=>{let[r,n]=this.toWorld(s[0],s[1],t);return{x:r,y:n,id:e}}))),this.ws.send(t(s[0],s[1],i.map((t=>[t.offset,t.id])))),n=await this.local.wait(0,500).then((t=>{switch(t){case Ur:let e=this.chunks.get(s[0],s[1]);return e&&i.forEach((t=>e.set(t.offset,t.id))),null;case $r:case Br:case Hr:case Vr:case qr:return en.errCanvasAPIInteraction;case Gr:return en.errMustAuth;case Yr:return en.errTooLowScore;case Zr:return en.errPixelProtected;case Qr:return en.errFullStack;case Kr:return en.errCaptcha;case Xr:return en.errYouAreProxy;case Jr:return en.errTooLowScore;case tn:return en.errParallelPlace;default:return new Error(`unknown retcode: ${t}`)}})).catch((t=>t===gr?en.errNoPlacePixelResult:t)),n)return n}return n}async getCaptcha(){let t=await fetch(an+"/captcha.svg",{cache:"no-cache"});if(!t.ok||200!==t.status)throw en.errCanvasAPIInteraction;let e=URL.createObjectURL(await t.blob()),r=t.headers.get("captcha-id");if(null===r)throw en.errCanvasAPIInteraction;return{id:r,svg:await fetch(e).then((t=>t.text()))}}async sendAnswer({solution:t,id:e}){this.ws.send(`cs,${JSON.stringify([t,e])}`);let r=await this.local.wait(1),n=[!0,rn.errCaptchaTimeout,!1,rn.errInvalidSolution,en.errCanvasAPIInteraction];return n.length>r?n[r]:en.errUnknownError}predictCooldown(t,e){let r=this.toTiled(t,e);return this.chunks.get(r[0],r[1]).get(r[2])<this.info.palette.offset?this.info.minCd:this.info.maxCd}destroy(){return this.dropChunks(this.loadQueue.map(cn)),this.ws.disconnect()}groupPixels(t){let e=(0,Rr.group)(t).by((t=>hn(this.toTiled(t.x,t.y).slice(0,2)))).asArrays(),r={};return e.forEach((t=>{let e=this.toTiled(t[0].x,t[0].y),n=hn(e.slice(0,2));r[n]=t.map((t=>({offset:this.toTiled(t.x,t.y)[2],id:t.id})))})),r}async waitChunks(t){for(t=t.slice().filter((t=>!this.chunks.has(t[0],t[1])));t.length;){let e=await this.emitter.wait(5,1e4),r=hn(e),n=t.findIndex((t=>hn(t)===r));-1!==n&&t.splice(n,1)}}processMarked(){if(!this.chunksProcessing){for(this.chunksProcessing=!0;this.loaders.length<this.maxLoaders;){let t=this.loadQueue.pop();if(void 0===t)break;let e=cn(t);if(this.chunks.has(e[0],e[1])||this.loaders.some((e=>e.chunk===t)))continue;let r={chunk:t,aborter:new AbortController};this.loaders.push(r),this.fetchChunk(e,r.aborter).then((t=>{this.chunks.set(t,e[0],e[1]),this.registerChunk(e),this.loaders.splice(this.loaders.indexOf(r),1),this.processMarked()}))}this.chunksProcessing=!1}}fetchChunk(t,e){let r=e?{signal:e.signal}:{};return fetch(`${an}/chunks/${this.canvasId}/${t[0]}/${t[1]}.bmp`,r).then((t=>{if(!t.ok)throw console.debug(t),en.errResponseIsntOk;if(200!==t.status)throw console.debug(t),en.errResponseStatusIsnt200;return t.arrayBuffer()})).then((e=>{let r=new Uint8Array(e),n=new Uint32Array(this.chunkSize);if(r.length===this.chunkSize)for(let t=0;t!==r.length;t++){let e=r[t];n[t]=e>=128?e-128:e}return this.emitter.emit(5,t),new jr(n)}))}registerChunk(t){this.ws.send(function(t){let e=new ArrayBuffer(3),r=new DataView(e);return r.setInt8(0,161),r.setInt16(1,t),e}(hn(t)))}deRegisterChunks(t){this.ws.send(function(t){let e=new ArrayBuffer(2+2*t.length),r=new Uint16Array(e);r[0]=164;for(let e=0;e<t.length;e+=1)r[e+1]=t[e];return e}(t.map((t=>hn(t)))))}toTiled(t,e){let r=t+(this.info.worldWidth>>1),n=e+(this.info.worldHeight>>1);return[r>>8,n>>8,(255&n)<<8|255&r]}toWorld(t,e,r){return[(t<<8)-(this.info.worldWidth>>1)+(255&r),(e<<8)-(this.info.worldHeight>>1)+(r>>8)]}selectCanvas(t){this.ws.send(function(t){let e=new ArrayBuffer(2),r=new DataView(e);return r.setInt8(0,160),r.setInt8(1,Number(t)),e}(t))}async fetchMe(){let t=(await fetch(`${an}/api/me`).then((t=>t.json()))).canvases[this.canvasId],{size:e}=t,r=ln[this.canvasId];this._info={id:r,name:sn[r],palette:{offset:t.cli,colors:t.colors},chunkWidth:256,chunkHeight:256,worldWidth:e,worldHeight:e,haveStack:!0,stack:t.cds,minCd:t.bcd,maxCd:t.pcd,borders:new Pr(-e/2,-e/2,e/2,e/2)}}handleArrivedPixel(t){let e=t.pixels.map((e=>{let[r,n]=this.toWorld(t.i,t.j,e[0]);return{x:r,y:n,id:e[1]}}));this.emitter.emit(3,e),this.delayedPixels.push(e),setTimeout((()=>{let r=this.delayedPixels.indexOf(e);if(-1!==r){this.delayedPixels.splice(r,1);let e=this.chunks.get(t.i,t.j);e&&t.pixels.forEach((t=>e.set(t[0],t[1])))}}),this.pixelsDelay)}},dn={};dn[0]=()=>un.build(0),dn[2]=()=>un.build(1),dn[3]=()=>un.build(3),dn[4]=()=>un.build(5),dn[5]=()=>un.build(6),dn[6]=()=>un.build(7),dn[7]=()=>un.build(8),dn[1]=()=>un.build(11),p=dn,f={},Object.entries(p).forEach((([t,e])=>{f[t]=()=>e().then((t=>new zr(t)))})),Object.keys(f),g=t=>f[t](),y={random:t=>z(m(t)),line_upToDown:m=t=>{let e=[],r=t.width,n=t.height;for(let i=0;i!==n;i++)for(let n=0;n!==r;n++)t.isTransparent(n,i)||e.push([n,i]);return e},line_downToUp:t=>{let e=m(t);for(let t=0;t!==e.length>>1;t++){let r=e.length-t-1;N(e,t,r)}return e},line_leftToRight:t=>$(m(t),(t=>t[0])),line_RightToLeft:t=>U(m(t),(t=>t[0])),circle_inToOut:t=>{let[e,r]=t.localCenter;return U(m(t),(t=>R(t[0]-e)+R(t[1]-r)))},circle_outToIn:t=>{let[e,r]=t.localCenter;return $(m(t),(t=>R(t[0]-e)+R(t[1]-r)))},throughLine:t=>{let e=t.size;return $(m(t),(t=>1&t[1]?t[0]+t[1]:t[0]+t[1]-e))},chess_1x1:t=>{let e=t.size;return $(m(t),(t=>(1&t[0])!=(1&t[1])?t[1]+e:t[1]))},chess_2x2:t=>{let e=t.size;return $(m(t),(t=>(3&t[0]^3&t[1])<=1?t[1]-e:t[1]))},chess_3x3:t=>{let e=t.size;return $(m(t),(t=>(7&t[0]^7&t[1])<=3?t[1]-e:t[1]))},chessCorner_1x1:t=>{let e=t.size;return $(m(t),(t=>(1&t[0])!=(1&t[1])?t[0]+t[1]+e:t[0]+t[1]))},woyken:t=>{let e=t.size,[r,n]=t.localCenter;return U(m(t),(i=>{let s=i[0],o=i[1];if(0!==s&&0!==o&&s!==t.width-1&&o!==t.height-1&&t.isOutline(s,o))return-e+o;if((s+o)%8==0||Math.abs(s-o)%8==0)return o;let a=R(s-r)+R(o-n);return e-Math.trunc(Math.sqrt(a))}))},colorByColor:t=>{let e=m(t),r={};e.forEach((e=>{let n=t.get(e[0],e[1]),i=r[n];i?i.push(e):r[n]=[e]})),e=new Array(e.length);let n=t.size,i=[t.width/2,t.height/2],s=0;return Object.values(r).forEach((t=>{$(t,(t=>n-Math.trunc(Math.sqrt(R(t[0]-i[0])+R(t[1]-i[1]))))),t.forEach((t=>e[s++]=t))})),e},squareBySquare:t=>{let e=[];for(let r=0;r<t.height;r+=8)for(let n=0;n<t.width;n+=8)for(let i=r;i!==r+8&&!(i>=t.height);i++)for(let r=n;r!==n+8;r++)r>=t.width||t.isTransparent(r,i)||e.push([r,i]);return e},zipper:t=>$(m(t),(t=>Math.trunc(Math.sqrt(t[0]+t[1])))),zipper2:t=>$(m(t),(e=>Math.trunc(Math.sqrt(e[0]+e[1]-3*t.get(e[0],e[1]))))),rhombLine:t=>{let[e,r]=t.localCenter;return m(t).sort(((t,n)=>Math.sin(Math.abs(t[0]-e)+Math.abs(t[1]-r))-Math.sin(Math.abs(n[0]-e)+Math.abs(n[1]-r))))},rhombLine2:t=>{let[e,r]=t.localCenter;return m(t).sort(((t,n)=>Math.tan(Math.abs(t[0]-e)+Math.abs(t[1]-r))-Math.tan(Math.abs(n[0]-e)+Math.abs(n[1]-r))))},alienRandom:t=>m(t).sort(((t,e)=>Math.tan(j(t[0]-e[1])-j(t[1]-e[0])))),alien1:t=>$(m(t),(t=>Math.tan(j(t[0])+j(t[1])))),alien2:t=>$(m(t),(t=>Math.exp(Math.cos(t[0]*t[1])))),alien3:t=>{let e=new Map;return $(m(t),(t=>{let r=e.get(t[0]);return void 0===r&&(r=Math.pow(7,t[0]*Math.sin(t[0])),e.set(t[0],r)),r-Math.pow(t[0],7*Math.sin(t[1]))}))},alien4:t=>{let e=new Map,r=new Map;return $(m(t),(t=>{let n=e.get(t[0]);void 0===n&&(n=Math.pow(Math.sin(t[0]),t[0]),e.set(t[0],n));let i=r.get(t[1]);return void 0===i&&(i=Math.pow(Math.cos(t[1]),t[1]),r.set(t[1],i)),n+i}))},complex:t=>{let[i,s]=function(t,e){let r=t.width-1,n=t.height-1,i=[],s=[];return e.forEach((e=>{0===e[0]||0===e[1]||e[0]===r||e[1]===n||t.isOutline(e[0],e[1])?i.push(e):s.push(e)})),[i,s]}(t,m(t)),o=(t,e)=>j(t[0]-e[0])+j(t[1]-e[1]),a=Object.values(e(t,s)),l=U(Object.values(e(t,i)),(t=>t.length));i=s=[];let h=a.map(r),c=[],u=[];for(let e=0;e!==l.length;e++){let i=l[e],s=r(i),d=t.get(i[0][0],i[0][1]);u.push(n(z(i)));let p=-1,f=1/0;if(a.forEach(((e,r)=>{let n=t.get(e[0][0],e[0][1]);if(d!==n||c.includes(r))return;let i=o(s,h[r]);i<f&&(f=i,p=r)})),-1===p){if(c.length===a.length){u.push(...l.slice(e+1).map(n));break}for(;-1===p;)p=Math.trunc(Math.random()*a.length),c.includes(p)&&(p=-1)}else c.push(p),u.push(n(a[p]))}return[].concat(...u)},binary:t=>$(m(t),(t=>t[0]&t[1])),near:t=>n(z(m(t)))},w=new Error("template unloaded"),v=new Error("template unquantized"),b=class t extends Pr{constructor(e){super(e.x,e.y,e.x+(e.width||0),e.y+(e.height||0)),this.readyState=t.UNLOADED,this.ctx=null,this.ids=new Uint8Array(0),this.name=e.name}static{this.UNLOADED=0}static{this.LOADING=1}static{this.LOADED=2}static{this.QUANTIZED=3}get canvas(){return this.ctx?.canvas}get size(){return this.width*this.height}get(t,e){return this.ids[t+e*this.width]}isTransparent(t,e){return 255===this.get(t,e)}countTransparent(){if(this.readyState===t.QUANTIZED){let t=0;for(let e of this.ids)255===e&&t++;return t}throw v}isOutline(t,e){let r=this.get(t,e);return this.get(t-1,e-1)!==r||this.get(t-1,e)!==r||this.get(t-1,e+1)!==r||this.get(t,e-1)!==r||this.get(t,e+1)!==r||this.get(t+1,e-1)!==r||this.get(t+1,e)!==r||this.get(t+1,e+1)!==r}intersects(t,e,r,n){return this.x1<r&&this.x2>t&&this.y1<n&&this.y2>e}load(e){return this.readyState=t.LOADING,M(e).then((e=>(this.ctx=document.createElement("canvas").getContext("2d"),this.ctx.canvas.width=this.width=e.width,this.ctx.canvas.height=this.height=e.height,this.ctx.drawImage(e,0,0),this.readyState=t.LOADED,this)))}quantize(e){if(!this.ctx)throw w;let r=this.ctx.getImageData(0,0,this.width,this.height),n=r.data;this.ids=new Uint8Array(n.length>>2);let i=new Map;for(let t=0;t!==n.length;t+=4)if(0===n[3|t])this.ids[t>>2]=255,n[0|t]=n[1|t]=n[2|t]=n[3|t]=0;else{let r=n[0|t]<<16|n[1|t]<<8|n[2|t],s=i.get(r);s||(s=e.convert(r>>16,r>>8&255,255&r),i.set(r,s)),this.ids[t>>2]=s;let o=e.idToRGB(s);n[0|t]=o[0],n[1|t]=o[1],n[2|t]=o[2],n[3|t]=255}return this.ctx.putImageData(r,0,0),this.readyState=t.QUANTIZED,this}},x=class{constructor(t,e){this.api=t,this.template=e,this.template.readyState===b.LOADED&&this.template.quantize(this.api.palette)}get width(){return this.template.width}get height(){return this.template.height}_countErrors(){let t=this.api.palette,e=0,r=0,n=this.template.width,i=this.template.height;for(let s=0;s!=i;s++)for(let i=0;i!=n;i++){let n=this.template.get(i,s);if(255===n)continue;let o=i+this.template.x1,a=s+this.template.y1,l=this.api.get(o,a);t.sameIds(n,l)||(e++,r+=this.api.predictCooldown(o,a))}return{errors:e,timeToEnd:r}}checkTarget(t){return!this.api.palette.sameIds(this.template.get(t[0],t[1]),this.api.get(t[0]+this.template.x1,t[1]+this.template.y1))}handleTarget(t){let e=this.template.get(t[0],t[1]),r=this.api.get(t[0]+this.template.x1,t[1]+this.template.y1);if(!this.api.palette.sameIds(e,r))return{x:t[0]+this.template.x1,y:t[1]+this.template.y1,id:e}}targetToPixel(t){return{x:t[0]+this.template.x1,y:t[1]+this.template.y1,id:this.template.get(t[0],t[1])}}pixelToTarget(t){return[t.x-this.template.x1,t.y-this.template.y1]}},C=class{constructor(t){this.max=t,this.value=0}get(){return this.value}inc(t=1){for(let e=0;e!==t;e++)this.value++,this.value===this.max&&(this.value=0);return this.value}deinc(){return this.value--,-1===this.value&&(this.value=this.max-1),this.value}},P=class extends x{constructor(t,e,r){super(t,e),this.targets=r(this.template),this.counter=new C(this.targets.length)}nexts(t){let e=this.targets.length,r=[],n=this.handleTarget(this.targets[this.counter.get()]);if(n&&r.push(n)===t)return r;for(let n=0;n!==e&&0!==this.counter.get();n++){let e=this.handleTarget(this.targets[this.counter.deinc()]);if(!e)break;if(r.push(e)===t)return r}for(let n=0;n!==e;n++){let e=this.handleTarget(this.targets[this.counter.inc()]);if(e&&r.push(e)===t)return r}return r}countErrors(){return this.targets?this.countErrorsUsingTargets():this._countErrors()}countTargets(){return this.targets.length}countErrorsUsingTargets(){let t=this.api.palette,e=0,r=0;for(let n=0;n!==this.targets.length;n++){let i=this.targets[n],s=i[0]+this.template.x1,o=i[1]+this.template.y1;!t.sameIds(this.template.get(i[0],i[1]),this.api.get(s,o))&&(e++,r+=this.api.predictCooldown(s,o))}return{errors:e,timeToEnd:r}}},k={};for(let t in y)k[t]=(e,r)=>new P(e,r,y[t]);if(S=(t,e,r)=>"string"==typeof r?r in k?k[r](t,e):void 0:new P(t,e,r),E=(t,e)=>{"Notification"in window&&("granted"===Notification.permission?new Notification(t,e):"denied"!==Notification.permission&&Notification.requestPermission((r=>"granted"===r&&new Notification(t,e))))},T=t=>document.querySelector(t),M=t=>new Promise(((e,r)=>{let n=new Image;n.crossOrigin="",n.onload=()=>e(n),n.onerror=r,n.src=t})),O=new Set,A=()=>{let t=0;do{t=parseInt(Math.random().toString().substring(2))}while(O.has(t));return O.add(t),t},I=()=>A().toString().split("").map((t=>String.fromCharCode(65+parseInt(t)%26))).join(""),_=t=>t.split("").join("‎"),j=t=>t*t,L=t=>new Promise((e=>setTimeout(e,t))),D=t=>Date.now()-t,W=new RegExp(/-?\d+/g),F=t=>t.match(W)?.map(parseFloat),z=t=>{for(let e=t.length-1;-1!==e;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t},N=(t,e,r)=>{let n=t[e];t[e]=t[r],t[r]=n},R=t=>j(Math.floor(t)),U=(t,e)=>t.sort(((t,r)=>e(t)>e(r)?1:-1)),$=(t,e)=>t.sort(((t,r)=>e(t)<e(r)?1:-1)),B=t=>{let e=0;for(let r=0;r!==t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e},H=()=>{if(/.*:\/\/.*(pixelplanet)|(fuckyouarkeros)\.fun.*/.test(location.origin)||/localhost/.test(location.origin)){let t=location.hash.match(/#[a-z]/g);return t?.length?{d:0,s:1,m:2,c:3,y:4,z:5,w:6,t:7}[t[0][1]]:void 0}},V=(t,e)=>t+Math.floor(Math.random()*(e-t)),q=t=>t[t.length-1],G=(t,e,r)=>{let n=0,i=0,s=0,o=0,a=t=>Z(0,t,unsafeWindow.innerWidth-e.offsetWidth),l=t=>Z(0,t,unsafeWindow.innerHeight-e.offsetHeight);e.style.top=l(e.offsetTop)+"px",e.style.left=a(e.offsetLeft)+"px";let h=t=>{t.preventDefault(),n=s-t.clientX,i=o-t.clientY,s=t.clientX,o=t.clientY,e.style.top=l(e.offsetTop-i)+"px",e.style.left=a(e.offsetLeft-n)+"px";let h=F(e.style.left),c=F(e.style.top);h&&c&&r?.(h[0],c[0])},c=()=>{window.removeEventListener("mouseup",c),window.removeEventListener("mousemove",h)};t.addEventListener("mousedown",(t=>{t.preventDefault(),s=t.clientX,o=t.clientY,window.addEventListener("mouseup",c),window.addEventListener("mousemove",h)}))},Y=null,document.addEventListener("keydown",(t=>{Y&&(t.stopPropagation(),Y(t))}),!0),Y=null,Z=(t,e,r)=>Math.max(t,Math.min(e,r)),Q=(t,e="unnamed")=>{let r=document.createElement("a");r.setAttribute("href",t.toDataURL("image/png")),r.setAttribute("download",e),r.click()},K=(t,e="unnamed")=>{let r=document.createElement("a");r.setAttribute("href","data:text/html;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.click()},X=t=>{if(!(t instanceof P))return;let{width:e,height:r,targets:n}=t,i=document.createElement("canvas").getContext("2d");i.canvas.width=e,i.canvas.height=r;let s=i.getImageData(0,0,e,r),{data:o}=s;return n.forEach(((t,r)=>{let i=Math.floor((n.length-r)/n.length*255),s=t[1]*e+t[0]<<2;o[0|s]=i,o[3|s]=255})),i.putImageData(s,0,0),i},J=t=>{if(!(t instanceof P))return;let{width:e,height:r,targets:n}=t,i=new Array(n.length<<1),s=new Array(n.length);n.forEach(((e,r)=>{i[r<<1]=e[0].toString(),i[r<<1|1]=e[1].toString(),s[r]=t.template.get(e[0],e[1]).toString()}));let o=t.api.palette.colors.flat();return`\n\t\t<!DOCTYPE html>\n\t\t<html>\n\t\t\t<body style="background: black;">\n\t\t\t\t<div style="position: absolute; top: 0; left: 0; height: 100%">\n\t\t\t\t\t<canvas style="height: 100%; border: 1px red solid; background: rgba(64, 64, 64, 0.3);"></canvas>\n\t\t\t\t</div>\n\t\t\t\t<script>\n\t\t\t\t\tconst width = ${e};\n\t\t\t\t\tconst height = ${r};\n\t\t\t\t\tconst ctx = document.querySelector('canvas').getContext('2d');\n\t\t\t\t\tctx.canvas.width = width;\n\t\t\t\t\tctx.canvas.height = height;\n\t\t\t\t\tctx.clearRect(0, 0, width, height);\n\n\t\t\t\t\tctx.mozImageSmoothingEnabled = false;\n\t\t\t\t\tctx.webkitImageSmoothingEnabled = false;\n\t\t\t\t\tctx.msImageSmoothingEnabled = false;\n\t\t\t\t\tctx.imageSmoothingEnabled = false;\n\n\t\t\t\t\tconst delay = 100;\n\t\t\t\t\tconst pixelsAtOnce = 10;\n\n\t\t\t\t\tconst targets = new Uint16Array([${i.join(",")}]);\n\t\t\t\t\tconst colors = new Uint8Array([${s.join(",")}]);\n\t\t\t\t\tconst palette = new Uint8Array([${o.join(",")}]);\n\n\t\t\t\t\t(async () => {\n\t\t\t\t\t\tlet prevClrId = -1;\n\t\t\t\t\t\tfor (let i = 0; i !== targets.length; i+=2) {\n\t\t\t\t\t\t\tconst id = colors[i >> 1];\n\t\t\t\t\t\t\tif (prevClrId !== id) {\n\t\t\t\t\t\t\t\tconst j = id * 3;\n\t\t\t\t\t\t\t\tctx.fillStyle = 'rgb(' + [palette[j], palette[j + 1], palette[j + 2]] + ')';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tctx.fillRect(targets[i], targets[i | 1], 1, 1)\n\t\t\t\t\t\t\tconst a = (i >> 1) / pixelsAtOnce;\n\t\t\t\t\t\t\tif (~~a === a) {\n\t\t\t\t\t\t\t\tawait new Promise(r => setTimeout(r, delay));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})();\n\t\t\t\t<\/script>\n\t\t\t</body>\n\t\t</html>`},tt=async({delay:t,func:e,maxAttempts:r,onerror:n})=>{let i=0;for(;i<r;)try{return await e()}catch(e){i++,n?.(e),await L(t)}throw vr},et=t=>new Promise((e=>{let r=document.createElement("input");r.type="file",t&&(r.accept=t),r.addEventListener("change",(()=>e(r.files?.length?r.files[0]:null))),r.click()})),rt=()=>"image/*",nt=()=>et(rt()),it=t=>t[~~(Math.random()*t.length)],st=(t,e)=>j(t[0]-e[0])+j(t[1]-e[1]),ot=4e3,at=class extends xr{constructor(t){super(),this.url=t,this.online=null,(async()=>{for(;;)await this.ping().then((t=>{this.online=t,this.emit(0,this.online)})).catch((t=>{this.online=null,this.emit(1,t)})),await L(this.getPingDelay())})()}getOnline(){return this.online}getPingDelay(){return null===this.online?12e4:36e5/ot*this.online+4e4}ping(){return fetch(this.url+"/online",{method:"POST"}).then((t=>t.text())).then((t=>+t))}},lt=new xr,ht="zipper2",ct={smartPlace:!0,showErrors:!0},ut=!0,dt=[16,16],pt=1,ft=3,gt={},yt="http://www.w3.org/2000/svg",wt=t=>t,vt=(mt=[]).map,bt=Array.isArray,xt=typeof requestAnimationFrame<"u"?requestAnimationFrame:setTimeout,Ct=t=>{var e,r,n="";if("string"==typeof t)return t;if(bt(t))for(e=0;e<t.length;e++)(r=Ct(t[e]))&&(n+=(n&&" ")+r);else for(e in t)t[e]&&(n+=(n&&" ")+e);return n},Pt=(t,e)=>{for(var r in{...t,...e})if("function"==typeof(bt(t[r])?t[r][0]:t[r]))e[r]=t[r];else if(t[r]!==e[r])return!0},kt=(t,e=mt,r)=>{for(var n,i,s=[],o=0;o<t.length||o<e.length;o++)n=t[o],i=e[o],s.push(i&&!0!==i?!n||i[0]!==n[0]||Pt(i[1],n[1])?[i[0],i[1],(n&&n[2](),i[0](r,i[1]))]:n:n&&n[2]());return s},St=t=>null==t?t:t.key,Et=(t,e,r,n,i,s)=>{if("style"===e)for(var o in{...r,...n})r=null==n||null==n[o]?"":n[o],"-"===o[0]?t[e].setProperty(o,r):t[e][o]=r;else"o"===e[0]&&"n"===e[1]?((t.events||(t.events={}))[e=e.slice(2)]=n)?r||t.addEventListener(e,i):t.removeEventListener(e,i):!s&&"list"!==e&&"form"!==e&&e in t?t[e]=n??"":null==n||!1===n?t.removeAttribute(e):t.setAttribute(e,n)},Tt=(t,e,r)=>{var n,i,s=t.props,o=t.type===ft?document.createTextNode(t.tag):(r=r||"svg"===t.tag)?document.createElementNS(yt,t.tag,s.is&&s):document.createElement(t.tag,s.is&&s);for(n in s)Et(o,n,null,s[n],e,r);for(i=0;i<t.children.length;i++)o.appendChild(Tt(t.children[i]=At(t.children[i]),e,r));return t.node=o},Mt=(t,e,r,n,i,s)=>{var o,a,l,h,c,u,d,p,f,g,m,y,w,v,b;if(r!==n)if(null!=r&&r.type===ft&&n.type===ft)r.tag!==n.tag&&(e.nodeValue=n.tag);else if(null==r||r.tag!==n.tag)e=t.insertBefore(Tt(n=At(n),i,s),e),null!=r&&t.removeChild(r.node);else{for(w in c=r.props,u=n.props,d=r.children,p=n.children,f=0,g=0,m=d.length-1,y=p.length-1,s=s||"svg"===n.tag,{...c,...u})("value"===w||"selected"===w||"checked"===w?e[w]:c[w])!==u[w]&&Et(e,w,c[w],u[w],i,s);for(;g<=y&&f<=m&&null!=(l=St(d[f]))&&l===St(p[g]);)Mt(e,d[f].node,d[f],p[g]=At(p[g++],d[f++]),i,s);for(;g<=y&&f<=m&&null!=(l=St(d[m]))&&l===St(p[y]);)Mt(e,d[m].node,d[m],p[y]=At(p[y--],d[m--]),i,s);if(f>m)for(;g<=y;)e.insertBefore(Tt(p[g]=At(p[g++]),i,s),(a=d[f])&&a.node);else if(g>y)for(;f<=m;)e.removeChild(d[f++].node);else{for(v={},b={},w=f;w<=m;w++)null!=(l=d[w].key)&&(v[l]=d[w]);for(;g<=y;)l=St(a=d[f]),h=St(p[g]=At(p[g],a)),b[l]||null!=h&&h===St(d[f+1])?(null==l&&e.removeChild(a.node),f++):null==h||r.type===pt?(null==l&&(Mt(e,a&&a.node,a,p[g],i,s),g++),f++):(l===h?(Mt(e,a.node,a,p[g],i,s),b[h]=!0,f++):null!=(o=v[h])?(Mt(e,e.insertBefore(o.node,a&&a.node),o,p[g],i,s),b[h]=!0):Mt(e,a&&a.node,null,p[g],i,s),g++);for(;f<=m;)null==St(a=d[f++])&&e.removeChild(a.node);for(w in v)null==b[w]&&e.removeChild(v[w].node)}}return n.node=e},Ot=(t,e)=>{var r;for(r in t)if(t[r]!==e[r])return!0;for(r in e)if(t[r]!==e[r])return!0},At=(t,e)=>!0!==t&&!1!==t&&t?"function"==typeof t.tag?((!e||null==e.memo||Ot(e.memo,t.memo))&&((e=t.tag(t.memo)).memo=t.memo),e):t:jt(""),It=t=>t.nodeType===ft?jt(t.nodeValue,t):_t(t.nodeName.toLowerCase(),gt,vt.call(t.childNodes,It),pt,t),_t=(t,{key:e,...r},n,i,s)=>({tag:t,props:r,key:e,children:n,type:i,node:s}),jt=(t,e)=>_t(t,gt,mt,ft,e),Lt=(t,{class:e,...r},n=mt)=>_t(t,{...r,...e?{class:Ct(e)}:gt},bt(n)?n:[n]),Dt=({node:t,view:e,subscriptions:r,dispatch:n=wt,init:i=gt})=>{var s,o,a=t&&It(t),l=[],h=t=>{s!==t&&(null==(s=t)&&(n=r=c=wt),r&&(l=kt(l,r(s),n)),e&&!o&&xt(c,o=!0))},c=()=>t=Mt(t.parentNode,t,a,a=e(s),u,o=!1),u=function(t){n(this.events[t.type],t)};return(n=n(((t,e)=>"function"==typeof t?n(t(s,e)):bt(t)?"function"==typeof t[0]?n(t[0],t[1]):t.slice(1).map((t=>t&&!0!==t&&(t[0]||t)(n,t[1])),h(t[0])):h(t))))(i),n},Ft="green",zt={width:"100%"},Nt={fontFamily:"monospace"},Rt={cursor:"pointer"},Ut=t=>({width:`${t}px`,height:`${t}px`}),$t={color:"red",position:"absolute",fontWeight:"bolder",fontFamily:"system-ui",fontSize:"14px",width:"400px",background:"rgba(0, 0, 0, 0.9)",padding:"4px",border:"1px solid",borderColor:Wt="darkred",display:"flex",flexDirection:"column",gap:"2px"},Bt={fontWeight:"bold",fontSize:"18px"},Ht={cursor:"move",display:"flex",justifyContent:"space-between"},Vt={display:"inline-flex",color:"red",columnGap:"5px"},qt={background:"red",height:"1px",marginTop:"2px",marginBottom:"2px"},Gt={display:"grid",gridTemplateColumns:"50% 50%",gridTemplateRows:"auto 1fr",rowGap:"6px",columnGap:"10px"},Yt={...{fontWeight:"bold",fontSize:"14px"},textTransform:"uppercase"},Zt={paddingLeft:"5px",display:"flex",flexDirection:"column",gap:"5px"},Qt={color:"inherit",...zt,...Nt,fontWeight:"inherit",background:"transparent",outline:"none"},Kt={display:"flex",gap:"5px",flexDirection:"column"},Xt={display:"flex",gap:"4px"},Jt={display:"flex",gap:"4px",alignItems:"center"},te={background:"black"},ee={background:"inherit",...zt,color:"inherit",cursor:"pointer",borderColor:Wt,font:"inherit",outline:"none"},re={...Nt,display:"inline-flex",gap:"5px",alignItems:"center"},ne={width:"",...Ut(14)},ie={lineHeight:"90%"},se={...Rt,display:"flex",gap:"5px",alignItems:"center"},oe={opacity:"0.6",fontSize:"12px",lineHeight:"20px"},ae=t=>jt(_(t)),le=({size:t})=>({stroke:"currentColor",fill:"currentColor","stroke-width":"0",height:`${t}px`,width:`${t}px`,xmlns:"http://www.w3.org/2000/svg",role:"img"}),he=({style:t,size:e})=>Lt("svg",{style:t,viewBox:"0 0 24 24",...le({size:e})},Lt("path",{d:"M15 4H5V20H19V8H15V4ZM3 2.9918C3 2.44405 3.44749 2 3.9985 2H16L20.9997 7L21 20.9925C21 21.5489 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5447 3 21.0082V2.9918ZM13 12V16H11V12H8L12 8L16 12H13Z"})),ce=({style:t,size:e})=>Lt("svg",{style:t,viewBox:"0 0 16 16",...le({size:e})},[Lt("path",{d:"M5.5 9.511c.076.954.83 1.697 2.182 1.785V12h.6v-.709c1.4-.098 2.218-.846 2.218-1.932 0-.987-.626-1.496-1.745-1.76l-.473-.112V5.57c.6.068.982.396 1.074.85h1.052c-.076-.919-.864-1.638-2.126-1.716V4h-.6v.719c-1.195.117-2.01.836-2.01 1.853 0 .9.606 1.472 1.613 1.707l.397.098v2.034c-.615-.093-1.022-.43-1.114-.9zm2.177-2.166c-.59-.137-.91-.416-.91-.836 0-.47.345-.822.915-.925v1.76h-.005zm.692 1.193c.717.166 1.048.435 1.048.91 0 .542-.412.914-1.135.982V8.518z"}),Lt("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"}),Lt("path",{d:"M8 13.5a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11m0 .5A6 6 0 1 0 8 2a6 6 0 0 0 0 12"})]),ue=({style:t,size:e})=>Lt("svg",{style:t,viewBox:"0 0 15 15",...le({size:e})},[Lt("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"currentColor",d:"M5.07451 1.82584C5.03267 1.81926 4.99014 1.81825 4.94803 1.82284C4.10683 1.91446 2.82673 2.36828 2.07115 2.77808C2.02106 2.80525 1.97621 2.84112 1.93869 2.88402C1.62502 3.24266 1.34046 3.82836 1.11706 4.38186C0.887447 4.95076 0.697293 5.55032 0.588937 5.98354C0.236232 7.39369 0.042502 9.08728 0.0174948 10.6925C0.0162429 10.7729 0.0351883 10.8523 0.0725931 10.9234C0.373679 11.496 1.02015 12.027 1.66809 12.4152C2.32332 12.8078 3.08732 13.1182 3.70385 13.1778C3.85335 13.1922 4.00098 13.1358 4.10282 13.0255C4.2572 12.8581 4.5193 12.4676 4.71745 12.1643C4.80739 12.0267 4.89157 11.8953 4.95845 11.7901C5.62023 11.9106 6.45043 11.9801 7.50002 11.9801C8.54844 11.9801 9.37796 11.9107 10.0394 11.7905C10.1062 11.8957 10.1903 12.0269 10.2801 12.1643C10.4783 12.4676 10.7404 12.8581 10.8947 13.0255C10.9966 13.1358 11.1442 13.1922 11.2937 13.1778C11.9102 13.1182 12.6742 12.8078 13.3295 12.4152C13.9774 12.027 14.6239 11.496 14.925 10.9234C14.9624 10.8523 14.9813 10.7729 14.9801 10.6925C14.9551 9.08728 14.7613 7.39369 14.4086 5.98354C14.3003 5.55032 14.1101 4.95076 13.8805 4.38186C13.6571 3.82836 13.3725 3.24266 13.0589 2.88402C13.0214 2.84112 12.9765 2.80525 12.9264 2.77808C12.1708 2.36828 10.8907 1.91446 10.0495 1.82284C10.0074 1.81825 9.96489 1.81926 9.92305 1.82584C9.71676 1.85825 9.5391 1.96458 9.40809 2.06355C9.26977 2.16804 9.1413 2.29668 9.0304 2.42682C8.86968 2.61544 8.71437 2.84488 8.61428 3.06225C8.27237 3.03501 7.90138 3.02 7.5 3.02C7.0977 3.02 6.72593 3.03508 6.38337 3.06244C6.28328 2.84501 6.12792 2.61549 5.96716 2.42682C5.85626 2.29668 5.72778 2.16804 5.58947 2.06355C5.45846 1.96458 5.2808 1.85825 5.07451 1.82584ZM11.0181 11.5382C11.0395 11.5713 11.0615 11.6051 11.0838 11.6392C11.2169 11.843 11.3487 12.0385 11.4508 12.1809C11.8475 12.0916 12.352 11.8818 12.8361 11.5917C13.3795 11.2661 13.8098 10.8918 14.0177 10.5739C13.9852 9.06758 13.7993 7.50369 13.4773 6.21648C13.38 5.82759 13.2038 5.27021 12.9903 4.74117C12.7893 4.24326 12.5753 3.82162 12.388 3.5792C11.7376 3.24219 10.7129 2.88582 10.0454 2.78987C10.0308 2.79839 10.0113 2.81102 9.98675 2.82955C9.91863 2.881 9.84018 2.95666 9.76111 3.04945C9.71959 3.09817 9.68166 3.1471 9.64768 3.19449C9.953 3.25031 10.2253 3.3171 10.4662 3.39123C11.1499 3.6016 11.6428 3.89039 11.884 4.212C12.0431 4.42408 12.0001 4.72494 11.788 4.884C11.5759 5.04306 11.2751 5.00008 11.116 4.788C11.0572 4.70961 10.8001 4.4984 10.1838 4.30877C9.58933 4.12585 8.71356 3.98 7.5 3.98C6.28644 3.98 5.41067 4.12585 4.81616 4.30877C4.19988 4.4984 3.94279 4.70961 3.884 4.788C3.72494 5.00008 3.42408 5.04306 3.212 4.884C2.99992 4.72494 2.95694 4.42408 3.116 4.212C3.35721 3.89039 3.85011 3.6016 4.53383 3.39123C4.77418 3.31727 5.04571 3.25062 5.35016 3.19488C5.31611 3.14738 5.27808 3.09831 5.23645 3.04945C5.15738 2.95666 5.07893 2.881 5.01081 2.82955C4.98628 2.81102 4.96674 2.79839 4.95217 2.78987C4.28464 2.88582 3.25999 3.24219 2.60954 3.5792C2.42226 3.82162 2.20825 4.24326 2.00729 4.74117C1.79376 5.27021 1.61752 5.82759 1.52025 6.21648C1.19829 7.50369 1.01236 9.06758 0.97986 10.5739C1.18772 10.8918 1.61807 11.2661 2.16148 11.5917C2.64557 11.8818 3.15003 12.0916 3.5468 12.1809C3.64885 12.0385 3.78065 11.843 3.9138 11.6392C3.93626 11.6048 3.95838 11.5708 3.97996 11.5375C3.19521 11.2591 2.77361 10.8758 2.50064 10.4664C2.35359 10.2458 2.4132 9.94778 2.63377 9.80074C2.85435 9.65369 3.15236 9.71329 3.29941 9.93387C3.56077 10.3259 4.24355 11.0201 7.50002 11.0201C10.7565 11.0201 11.4392 10.326 11.7006 9.93386C11.8477 9.71329 12.1457 9.65369 12.3663 9.80074C12.5869 9.94779 12.6465 10.2458 12.4994 10.4664C12.2262 10.8762 11.8041 11.2598 11.0181 11.5382ZM4.08049 7.01221C4.32412 6.74984 4.65476 6.60162 5.00007 6.59998C5.34538 6.60162 5.67603 6.74984 5.91966 7.01221C6.16329 7.27459 6.30007 7.62974 6.30007 7.99998C6.30007 8.37021 6.16329 8.72536 5.91966 8.98774C5.67603 9.25011 5.34538 9.39833 5.00007 9.39998C4.65476 9.39833 4.32412 9.25011 4.08049 8.98774C3.83685 8.72536 3.70007 8.37021 3.70007 7.99998C3.70007 7.62974 3.83685 7.27459 4.08049 7.01221ZM9.99885 6.59998C9.65354 6.60162 9.3229 6.74984 9.07926 7.01221C8.83563 7.27459 8.69885 7.62974 8.69885 7.99998C8.69885 8.37021 8.83563 8.72536 9.07926 8.98774C9.3229 9.25011 9.65354 9.39833 9.99885 9.39998C10.3442 9.39833 10.6748 9.25011 10.9184 8.98774C11.1621 8.72536 11.2989 8.37021 11.2989 7.99998C11.2989 7.62974 11.1621 7.27459 10.9184 7.01221C10.6748 6.74984 10.3442 6.60162 9.99885 6.59998Z"})]),de=({style:t,size:e})=>Lt("svg",{style:t,viewBox:"0 0 24 24",...le({size:e})},[Lt("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm3.163 21.783h-.093a.513.513 0 0 1-.382-.14.513.513 0 0 1-.14-.372v-1.406c.006-.467.01-.94.01-1.416a3.693 3.693 0 0 0-.151-1.028 1.832 1.832 0 0 0-.542-.875 8.014 8.014 0 0 0 2.038-.471 4.051 4.051 0 0 0 1.466-.964c.407-.427.71-.943.885-1.506a6.77 6.77 0 0 0 .3-2.13 4.138 4.138 0 0 0-.26-1.476 3.892 3.892 0 0 0-.795-1.284 2.81 2.81 0 0 0 .162-.582c.033-.2.05-.402.05-.604 0-.26-.03-.52-.09-.773a5.309 5.309 0 0 0-.221-.763.293.293 0 0 0-.111-.02h-.11c-.23.002-.456.04-.674.111a5.34 5.34 0 0 0-.703.26 6.503 6.503 0 0 0-.661.343c-.215.127-.405.249-.573.362a9.578 9.578 0 0 0-5.143 0 13.507 13.507 0 0 0-.572-.362 6.022 6.022 0 0 0-.672-.342 4.516 4.516 0 0 0-.705-.261 2.203 2.203 0 0 0-.662-.111h-.11a.29.29 0 0 0-.11.02 5.844 5.844 0 0 0-.23.763c-.054.254-.08.513-.081.773 0 .202.017.404.051.604.033.199.086.394.16.582A3.888 3.888 0 0 0 5.702 10a4.142 4.142 0 0 0-.263 1.476 6.871 6.871 0 0 0 .292 2.12c.181.563.483 1.08.884 1.516.415.422.915.75 1.466.964.653.25 1.337.41 2.033.476a1.828 1.828 0 0 0-.452.633 2.99 2.99 0 0 0-.2.744 2.754 2.754 0 0 1-1.175.27 1.788 1.788 0 0 1-1.065-.3 2.904 2.904 0 0 1-.752-.824 3.1 3.1 0 0 0-.292-.382 2.693 2.693 0 0 0-.372-.343 1.841 1.841 0 0 0-.432-.24 1.2 1.2 0 0 0-.481-.101c-.04.001-.08.005-.12.01a.649.649 0 0 0-.162.02.408.408 0 0 0-.13.06.116.116 0 0 0-.06.1.33.33 0 0 0 .14.242c.093.074.17.131.232.171l.03.021c.133.103.261.214.382.333.112.098.213.209.3.33.09.119.168.246.231.381.073.134.15.288.231.463.188.474.522.875.954 1.145.453.243.961.364 1.476.351.174 0 .349-.01.522-.03.172-.028.343-.057.515-.091v1.743a.5.5 0 0 1-.533.521h-.062a10.286 10.286 0 1 1 6.324 0v.005z"})]),pe=({state:t,onChange:e})=>Lt("div",{onclick:t=>(nt().then((async t=>{t&&async function(t){return new Promise((e=>{let r=new FileReader;r.onload=async()=>e(r.result),r.readAsDataURL(t)}))}(t).then((t=>{lt.emit(2,t),e(t)}))})),t),style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:"5px",alignItems:"center",overflow:"hidden",...Rt,borderColor:Wt,padding:"2px",borderWidth:"1px",borderStyle:"solid"}},[he({size:20}),null===t.templateSrc?Lt("span",{},jt("click to upload")):Lt("span",{},jt(t.templateSrc.slice(0,100)))]),fe=({state:t})=>Lt("div",{style:{borderColor:t.botWorksNow?Ft:Wt,borderWidth:"1px",borderStyle:"solid",padding:"2px",cursor:"pointer",width:"fit-content"},onclick:t=>(lt.emit(5),t)},ae("stop/start")),ge=({state:t})=>Lt("div",{style:Xt},[jt("x: "),Lt("input",{style:Qt,type:"number",oninput:(t,e)=>{let r=e.currentTarget.value,n=t.templateCoords.slice(0);return n[0]=r?+r:null,{...t,templateCoords:n}},value:t.templateCoords?.[0]??""})]),me=({state:t})=>Lt("div",{style:Xt},[jt("y: "),Lt("input",{style:Qt,type:"number",oninput:(t,e)=>{let r=e.currentTarget.value,n=t.templateCoords.slice(0);return n[1]=r?+r:null,{...t,templateCoords:n}},value:t.templateCoords?.[1]??""})]),ye=({style:t,href:e,childs:r})=>Lt("a",{style:{color:"inherit",display:"flex",alignItems:"center",justifyContent:"space-between",...t},href:e,target:"_blank"},r),we=({style:t,size:e})=>ye({style:t,href:Mr,childs:ue({size:e})}),ve=({style:t,size:e})=>ye({style:t,href:Or,childs:de({size:e})}),be=({style:t,size:e})=>ye({style:t,href:Tr,childs:ce({size:e})}),xe=({state:t})=>Lt("div",{style:se,onclick:t=>(lt.emit(12,!t.stopOnCaptcha),{...t,stopOnCaptcha:!t.stopOnCaptcha})},[Lt("span",{},ae("stop on captcha")),Lt("input",{type:"checkbox",checked:t.stopOnCaptcha})]),Ce=new Map,Pe=B(ht).toString(),Ce.set(Pe,ht),ke=(...t)=>{let e=t.some((t=>t>1e3))?1e3:0;return t.map((t=>(t=Math.floor(t),0===e?t.toString():(t/e).toFixed(1)+"k")))},Se=t=>{let e=it(Ar),r=document.createElement("div");document.body.appendChild(r);let n=(t,e)=>{let r=Ce.get(e.toString());return r?lt.emit(6,r):(console.warn(`cant define strategy for hash "${e}"\nuse default ("${ht}")`),lt.emit(6,ht)),{...t,selectedStrategy:e.toString()}},i=(t,e)=>({...t,templateCoords:e}),s=(t,e)=>({...t,templateSrc:e}),o=t=>l(s,t),a={appTop:"",botStatus:"-",strategies:{},cd:"-",onlineCounter:"-",buildPredict:"-",templateErrors:"-",progress:"-",windowX:t.storage.get("window.x")??unsafeWindow.innerWidth-400-dt[0],windowY:t.storage.get("window.y")??dt[1],placedPixel:[0,0],placedPixelColor:-1,templateSrc:t.storage.get("template.src"),botWorksNow:!1,stopOnCaptcha:t.storage.get("stopOnCaptcha")??ut,templateCoords:[t.storage.get("template.x"),t.storage.get("template.y")],selectedStrategy:ht},l=Dt({init:a,view:t=>Lt("div",{style:{...$t,left:`${t.windowX}px`,top:`${t.windowY}px`}},[Lt("div",{style:Ht},[Lt("div",{style:{display:"flex",alignItems:"baseline",columnGap:"5px"}},[Lt("span",{style:Bt},ae(e)),Lt("div",{style:{...oe,...typeof GM_info>"u"&&{display:"none"}}},jt(`v. ${GM_info?.script.version}`))]),Lt("div",{style:Vt},[we({size:20}),ve({size:20}),be({size:20})])]),Lt("div",{style:qt}),Lt("div",{style:Gt},[Lt("div",{style:Yt},ae("settings")),Lt("div",{style:Yt},ae("info")),Lt("div",{style:Zt},[Lt("div",{style:Kt},[ge({state:t}),me({state:t})]),Lt("div",{style:Jt},[ae("strategy:"),Lt("select",{style:ee,value:t.selectedStrategy,onchange:(t,e)=>n(t,e.currentTarget.value)},Object.entries(t.strategies).map((([t,e])=>Lt("option",{value:t,style:te},ae(e)))))]),xe({state:t}),pe({state:t,onChange:t=>o(t)}),fe({state:t})]),Lt("div",{style:Zt},[Lt("div",{style:ie},[ae("online: "),Lt("span",{style:Nt},ae(t.onlineCounter))]),Lt("div",{style:ie},[ae("status: "),Lt("span",{style:Nt},ae(t.botStatus))]),Lt("div",{style:ie},[ae("cooldown: "),Lt("span",{style:Nt},ae(t.cd))]),Lt("div",{style:ie},[ae("errors: "),Lt("span",{style:Nt},ae(t.templateErrors))]),Lt("div",{style:ie},[ae("progress: "),Lt("span",{style:Nt},ae(t.progress))]),Lt("div",{style:ie},[ae("end in: "),Lt("span",{style:Nt},ae(t.buildPredict))]),Lt("div",{style:ie},[ae("placed: "),Lt("span",{style:re},[Lt("span",{},ae(t.placedPixel[0].toString())),Lt("span",{},ae(t.placedPixel[1].toString())),"number"==typeof t.placedPixelColor?Lt("span",{},ae(t.placedPixelColor.toString())):Lt("span",{style:{...ne,background:`rgb(${t.placedPixelColor})`}})])])])])]),node:r}),h=(t,e)=>{let r=B(e).toString();return Ce.set(r,e),{...t,strategies:{...t.strategies,[r]:e}}},c=(t,e)=>({...t,botStatus:_("string"==typeof e?e:e.message)}),u=(t,e)=>({...t,cd:null===e?"-":e.toFixed(2)}),d=(t,e)=>({...t,onlineCounter:null===e?"-":e.toString()}),p=(t,[e,r])=>{let n;if(null===e)n="?";else{let t=[e];void 0!==r&&e!==r&&t.push(r),n=t[0]>7200?t.map((t=>t/3600)).map((t=>t.toFixed(1))).join("-")+"h":t[0]>120?t.map((t=>t/60)).map((t=>t.toFixed(1))).join("-")+"m":t.map((t=>t.toFixed(1))).join("-")+"s"}return{...t,buildPredict:n}},f=(t,[e,r])=>{let n={...t,templateErrors:"?",progress:"?"};if(null===e)void 0!==r&&(n.progress=`?/${ke(r)[0]}`);else if(void 0===r)n.templateErrors=ke(e)[0];else{let t=r-e,i=(t/r*100).toFixed(2);n.templateErrors=ke(e)[0],n.progress=ke(t,r).join("/")+` (${i}%)`}return n},g=(e,r)=>(t.storage.set("window.x",r[0]),t.storage.set("window.y",r[1]),{...e,windowX:r[0],windowY:r[1]}),m=(t,[e,r,n])=>({...t,placedPixel:[e,r],placedPixelColor:n});return function t(){r.firstChild?G(r.firstChild,r,((t,e)=>(t=>l(g,t))([t,e]))):setTimeout(t,250)}(),{root:r,getState:()=>new Promise((t=>l((e=>()=>(t(e),e))))),addStrategy:t=>l(h,t),setStrategy:t=>l(n,t),setBotStatus:t=>l(c,t),setCooldown:t=>l(u,t),setBotOnline:t=>l(d,t),setBuildPredict:(t,e)=>l(p,[t,e]),setProgress:(t,e)=>l(f,[t,e]),setLastPlaced:(...t)=>l(m,t),setTemplateCoords:(t,e)=>l(i,[t,e]),setTemplateSource:o}},Ee=new class{Println(...t){console.log("[INFO] ",...t)}},Te=new class{Println(...t){console.debug("[TRACE] ",...t)}},Me=new class{Println(...t){console.warn("[TRACE] ",...t)}},Oe=class extends xr{constructor(t,e,r,n=ct){super(),this.api=t,this.targeter=e,this.solver=r,this.options=n,this.status=0,this.pings=[100],this.noRetcodeInRow=0,this.captchaEmitted=!1,this.targeterToSet=null,this.placingAborter=null,this.loopAborter=null}start(){return this.status=2,this.loop()}stop(){if(0!==this.status)return 1===this.status||(this.status=1,this.abortPlacing(),this.abortLoop()),this.wait(2)}changeTargeter(t){this.abortPlacing(),this.targeterToSet=t}async loop(){for(this.emit(0,this.targeter.countErrors());2===this.status;){null!==this.targeterToSet&&(this.targeter=this.targeterToSet,this.targeterToSet=null);let[t,e,r]=await this.iteration();if(r)return r;if(2!==this.status)break;Ee.Println(`next tick after ${t.toString()} :: ${e}`),this.loopAborter=new kr,await Promise.any([L(t),this.loopAborter.promise]),this.loopAborter&&(this.loopAborter.destroy(),this.loopAborter=null)}return this.status=0,this.emit(2),null}async iteration(){let t=this.api.info.minCd,e=this.api.pixelsCanPlace();if(this.api.info.haveStack&&e<=1||0===e){let e=this.api.getCooldown(),r=0;return r=e<t?e:e-V(0,t),[r,"cooldown",null]}let r=this.targeter.nexts(e);if(0===r.length)return[V(3e3,Math.min(5*t,this.api.info.stack)),"no pixels to place",null];{Te.Println("place",r.map((t=>`[${t.x}_${t.y} ${t.id}]`)).join(", "));let t=null;if(this.options.smartPlace){this.placingAborter=new kr;try{[,t]=await this.api.smartPlace(r,this.placingAborter)}catch(t){console.log(t),lt.emit(8,t)}finally{this.placingAborter&&(this.placingAborter.destroy(),this.placingAborter=null)}}else{let e=Date.now();t=await this.api.placePixels(r);let n=D(e);this.registerPing(n),Te.Println("place ping",n)}if(t===en.errNoPlacePixelResult){if(this.noRetcodeInRow++,this.noRetcodeInRow>=3)return[0,"",wr];Me.Println(en.errNoPlacePixelResult)}else t===en.errParallelPlace?Me.Println(t):this.noRetcodeInRow=0;switch(t){case null:this.captchaEmitted=!1;break;case mr:case en.errNoPlacePixelResult:break;case en.errFullStack:Me.Println("unexpected cooldown",this.api.getCooldown());break;case en.errPixelProtected:Me.Println("protected pixel"),E("protected pixel, maybe admins catch you");break;case en.errCaptcha:if(null===this.solver)this.captchaEmitted||(this.emit(1),this.captchaEmitted=!0);else for(;;){Ee.Println("have captcha");let e=await this.api.getCaptcha();if(t)return[0,"",t];Ee.Println("captcha loaded, send to solver...");let r=await this.solver.solve(e);Ee.Println(`answer from solver "${JSON.stringify(r)}", send to canvas...`);let n=await this.api.sendAnswer(r);if(n instanceof Error)return[0,"",n];if(n){Ee.Println("solution is right");break}Ee.Println("solution is wrong, try again...")}return[6e3,`tried place ${r.length} pixels with CAPTCHA`,null];default:return[0,"",t]}let e=this.targeter.countErrors();return this.emit(0,e),[50,this.options.showErrors?`left ${e.errors} errors`:"pass",null]}}abortPlacing(){this.placingAborter&&(Ee.Println("stop bot placing with aborter"),this.placingAborter.abort())}abortLoop(){this.loopAborter&&(Ee.Println("stop bot loop with aborter"),this.loopAborter.abort())}registerPing(t){this.pings.length>=5&&this.pings.shift(),this.pings.push(t)}},(Ae={storage:new class extends br{constructor(t){super(),this.localStorageData={},this.data={},this.localStorageKey="storage",t&&t.localStorageKey&&(this.localStorageKey=t.localStorageKey),this.load()}set(t,e,r=!0){if(r&&t in this.data||!r&&t in this.localStorageData)throw new Error(`try to duplicate field "${t}" with value "${e}"`);r?(this.emit("beforeChangeLC."+t,e),this.localStorageData[t]=e,this.save(),this.emit("afterChangeLC."+t,e)):(this.emit("beforeChange."+t,e),this.data[t]=e,this.emit("afterChange."+t,e))}get(t){return t in this.data?this.data[t]:t in this.localStorageData?this.localStorageData[t]:null}has(t){return t in this.data||t in this.localStorageData}save(){Object.keys(this.localStorageData).length&&localStorage.setItem(this.localStorageKey,JSON.stringify(this.localStorageData))}load(){let t=localStorage.getItem(this.localStorageKey);null!==t&&(this.localStorageData=JSON.parse(t))}}({localStorageKey:Ir})}).storage.has("strategy")||Ae.storage.set("strategy",ht),Ae.storage.has("stopOnCaptcha")||Ae.storage.set("stopOnCaptcha",ut),fetch("https://raw.githubusercontent.com/TouchedByDarkness/PixelPlanet-Bot/master/secret.txt").then((t=>(t.ok||a(),t.text()))).then((t=>{"hf loves males"!==t.trim()&&a()})).catch(a),Ie=["/api/baninfo","/api/getiid","/api/shards","/api/modtools","/api/startdm","/api/leavechan","/api/block","/api/blockdm","/api/privatize","/api/chathistory","/api/me","/api/auth"],_e=unsafeWindow,je=_e.fetch,_e.fetch=function(t,e){let r;r=t instanceof Request?t.url:t.startsWith("http")?t:location.origin+(t.startsWith("/")?"":"/")+t;let n=new URL(r).pathname;if(n.startsWith("/api")&&!Ie.some((t=>n.startsWith(t)))){let t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random());return je(`https://pixelplanet.fun/chunks/0/${t}/${e}.bmp`)}return je(t,e)},I(),I(),I(),Le={coords:".coorbox",gameCanvas:".viewport"},De=new Error("errCantFindElement"),window.addEventListener("mousemove",(()=>{let t=T(Le.coords);if(!t)throw De;let e=F(t.textContent||"");e&&2===e.length&&lt.emit(7,[e[0],e[1]])})),!k[ht])throw yr;(We=Se(Ae)).setBotStatus("idle"),Fe=new Sr((async()=>{let t=await Re.get();if(!t)return null;await u();let e=await ze.get();if(!e)return null;let r=new Oe(t,e,null).on(0,(t=>lt.emit(9,t))).on(1,(()=>lt.emit(13)));return h("bot instance is ready"),r}),(t=>{h("cant create bot"),h(t),We.setBotStatus("error")})),ze=new Sr((async()=>{let[t,e]=await Promise.all([Ne.get(),Re.get()]);if(!t||!e)return null;!function(t,e){if(t.readyState!==b.QUANTIZED){let r=performance.now();t.quantize(e.palette),h("template quantized in",((performance.now()-r)/1e3).toFixed(3),"s.")}}(t,e);let r=Ae.storage.has("strategy")&&Ae.storage.get("strategy")in k?Ae.storage.get("strategy"):ht,n=performance.now(),i=S(e,t,r)||null;if(!i)throw fr;return h("targeter is ready in",((performance.now()-n)/1e3).toFixed(3),"s."),i}),(t=>{h("cant create targeter"),h(t),We.setBotStatus(t)})),Ne=new Sr((async()=>{let t=Ae.storage.get("template.x"),e=Ae.storage.get("template.y");if(null===t||null===e)throw dr;let r=Ae.storage.get("template.src");if(!r)throw ur;return new b({name:r.startsWith("data:image")?"cached":r.split("/")[0]||"unknown",x:t,y:e}).load(r).then((t=>(h("template is ready"),t)))}),(t=>{h("cant load template"),h(t),We.setBotStatus(t)})),Re=new Sr((async()=>{let t=H();if(void 0===t||!(t in nn))throw pr;return tt({maxAttempts:5,func:async()=>{let e=await g(t);return h("api is ready"),e.on(4,(t=>lt.emit(10,t))),e.on(3,(t=>lt.emit(11,t))),e},delay:1e3,onerror:t=>{h("create api error:\n",t),We.setBotStatus("cant create api")}})}),(t=>(h("cant create api",t),Promise.resolve(null)))),Ae.bot=Fe,Ae.targeter=ze,Ae.api=Re,Ae.template=Ne,unsafeWindow.db=Ae,(async()=>{await(()=>{let t=[Re.get()];return Ae.storage.has("template.x")&&Ae.storage.has("template.y")&&Ae.storage.has("template.src")&&t.push(Ne.get()),Promise.all(t)})(),setInterval((async()=>{let t=await Re.get();We.setCooldown(t?t.getCooldown()/1e3:null)}),110);let t=new at(Er);t.on(0,(t=>We.setBotOnline(t))),t.on(1,(t=>{console.error(t),We.setBotOnline(null)}));let e={worldX:0,worldY:0};lt.on(3,(async t=>{Ae.storage.set("template.x",t),Ne.ready&&(await(Fe.now()?.stop()),Ne.now()?.moveX(t))})),lt.on(4,(async t=>{Ae.storage.set("template.y",t),await(Fe.now()?.stop()),Ne.now()?.moveY(t)})),lt.on(2,(async t=>{Ae.storage.set("template.src",t),await Ne.clear(),c()})),lt.on(7,(([t,r])=>{e.worldX=t,e.worldY=r})),lt.on(5,l),lt.on(6,(t=>{Ae.storage.set("strategy",t),h(`change strategy to "${t}"`),c()})),Object.keys(k).forEach((t=>We.addStrategy(t))),We.setStrategy(B(Ae.storage.get("strategy")??ht)),lt.on(8,(t=>{We.setBotStatus("error"),Fe.now()?.stop(),h(t)})),lt.on(9,(async t=>{let[e,r]=t?[t.errors,t.timeToEnd]:[null,null],n=ze.now()?.countTargets();r&&(r instanceof Array?We.setBuildPredict(r[0]/1e3,r[1]/1e3):We.setBuildPredict(r/1e3)),We.setProgress(e,n)})),lt.on(10,(t=>{let e=q(t);if(e){let t=Re.now();We.setLastPlaced(e.x,e.y,t?.palette.idToRGB(e.id)??e.id)}})),lt.on(13,(()=>{Ae.storage.get("stopOnCaptcha")&&Fe.now()?.stop(),E("you need solve CAPTCHA")})),lt.on(14,(async()=>{let t=await ze.get();if(!t)return;let e=X(t);if(e){let t=await Ne.get(),r=t?.name?t.name+"_"+(Ae.storage.get("strategy")||"nostrat"):void 0;Q(e.canvas,r)}else h("heatmap canvas is undefined")})),lt.on(15,(async()=>{let t=await ze.get();if(!t)return;let e=J(t);if(e){let t=await Ne.get(),r=t?.name?t.name+"_"+(Ae.storage.get("strategy")||"nostrat"):void 0;K(e,r)}})),window.addEventListener("keydown",(({code:t})=>{if(!T(".show form")&&!T("#wm .show"))switch(t){case"KeyB":l();break;case"KeyN":lt.emit(3,e.worldX),lt.emit(4,e.worldY),We.setTemplateCoords(e.worldX,e.worldY)}}))})()})()}const console={log:window.console.debug,warn:window.console.debug,debug:window.console.debug,error:window.console.debug,trace:window.console.trace};window.addEventListener("error",console.debug),function t(){console.log("checking..."),"complete"===document.readyState&&document.querySelector("canvas")&&document.querySelector(".coorbox")?(console.log("run bot"),payload()):setTimeout(t,100)}();
} else {
const tab = GM_openInTab(GM_info.script.updateURL, { active: true });
tab.onclose = () => location.reload();
}
});
